---
title: Example 3 Branching ChatBot with Dynamic Variables and Global Re-routing
subtitle: Workflows Branching ChatBot with Dynamic Variables and Global Re-routing example
slug: workflows-example-3
mode: wide
---

## High-Level Description

This workflow builds upon Example 2 by introducing **dynamic variables** for runtime customization and **global re-routing** capabilities. Users can inject custom values (like greeting phrases, supported intents, farewell messages) at workflow execution time. Additionally, the router agent becomes globally accessible, allowing users to switch between agents mid-conversation - for example, starting with insurance questions, then switching to scheduling without ending the conversation.

## New Concepts Introduced

Building upon Examples 1 & 2, this workflow adds:

 1. **Dynamic Variables (Template Variables)**:
    - Runtime injection of custom values into prompts
    - Template syntax: `{{variable_name}}`
    - Allows personalization and configuration without changing workflow definition
    - Supports various data types: strings, arrays, objects

 2. **Global Router Agent (Re-routing)**:
    - Router agent with global configuration enabled
    - Allows users to switch intents mid-conversation
    - Enables fluid topic changes without starting over
    - Returns control to router from any specialized agent when user changes topic

 3. **Multiple Static Messages**:
    - Static message agents can output multiple farewell variations
    - Messages selected sequentially or randomly
 4. **Workflow Customization at Runtime**:
    - Same workflow definition, different execution behaviors
    - Inject branding, personalization, or configuration dynamically
    - Separate workflow logic from content

## Workflow Diagram

```Text
┌───────────────────────────┐
│  Greeting                 │ (START)
│  Agent                    │
│ Uses: `{{greeting_phrase}}` |
└────────┬──────────────────┘
         │ DirectEdge
         ▼
┌─────────────────┐ (GLOBAL - accessible from anywhere)
│  Router         │ ◄───────────────────────────────┐
│  Agent          │ ◄─┐                             │
│ Uses: `{{supported_intents}}`                       │
└────────┬────────┘   │ Self-loop                   │
         │            │                             │
         ├────────────┘                             │
         │                                          │
         ├─ ConditionalEdge (Insurance)             │
         ├─ ConditionalEdge (Scheduling)            │
         └─ ConditionalEdge (Payment)               │
                │                                   │
         ┌──────┴──────┬──────────────┐             │
         ▼             ▼              ▼             │
┌───────────────┐ ┌──────────────┐ ┌──────────────┐ │
│  Insurance    │ │  Scheduling  │ │  Payment     │ │
│  Agent        │ │  Agent       │ │  Agent       │ │
│               │ │              │ │              │ │
└───────┬───────┘ └──────┬───────┘ └──────┬───────┘ │
        │                │                │         │
        └────────────────┴────────────────┴─────────┘
                         │                    Global Re-routing
                         │                    (when user switches topic)
                         │
                         │ Global Edge (goodbye)
                         ▼
                 ┌─────────────────────────────┐
                 │  End                        │ (GLOBAL)  
                 │  Conversation   │           |
                 │  Uses: `{{farewell_phrase_1}}`|
                 │        `{{farewell_phrase_2}}`|
                 └─────────────────────────────┘
```

## New Configuration Elements

## Dynamic Variables

**Purpose**: Allow runtime customization of workflow content without modifying the workflow definition.

**Syntax in Prompts**: `{{variable_name}}`

**Example Usage in Greeting Agent**:

```Text
Prompt: "Welcome the user with a friendly message in less than 15 words. 
         Greet them politely and ask them what they would like to ask or talk about.
         In the greeting message, include the phrase `{{greeting_phrase}}`"
```

**Dynamic Variables Provided at Runtime**:

```Json
{
  "greeting_phrase": "Hello, Welcome to Cigna Healthcare",
  "supported_intents": ["appointments", "insurance", "payment"],
  "farewell_phrase_1": "Thank you for chatting with CignaCare Assistant. Have a great day!",
  "farewell_phrase_2": "We appreciate your time. Goodbye!"
}
```

**Benefits**:
 - Personalize greetings per customer or brand
 - Configure supported services dynamically
 - A/B test different messaging
 - Multi-tenancy: Same workflow, different branding

-----

## Global Router Agent (Re-routing)

**Purpose**: Allow users to change topics mid-conversation without restarting.

**Configuration**:

 - **is_global**: True
 - **Global Condition**:

```Text
Trigger this to come back to the internal routing agent when the user has clearly switched 
their intent in the middle of the conversation and want to do something different.

For example, if you are a scheduling assistant, and the user wants help with something else 
like insurance, trigger this tool.

Examples:
- "Actually, I have a question about my insurance." [when talking to scheduling]
- "I need help with scheduling, but first I have an insurance question." [when in payment]
- "Can you help me with payments instead?" [when in insurance]
```

**Behavior**:

 - Evaluated from Insurance, Scheduling, and Payment agents
 - When a user changes topic mid-conversation, control returns to Router
 - Router re-evaluates intent and routes to new destination
 - Conversation context is maintained

**User Experience**:

```Text
User: "I need to schedule an appointment"
→ Routing to Scheduling Agent
Scheduling: "I can help with that. Which doctor would you like to see?"
User: "Actually, I have a billing question first"
→ Global re-routing triggers
→ Returns to Router Agent
Router: "Of course! Let me connect you with our billing team."
→ Routes to Payment Agent
Payment: "I can help with billing. What's your question?"
```

## Agent Details

## Agent 1: Greeting Agent

**Configuration Changes from Example 2**:

 - **Prompt**: Now includes `{{greeting_phrase}}` template variable
 - Dynamic customization of greeting message

**Dynamic Variable Usage**:

 - `{{greeting_phrase}}` → "Hello, Welcome to Cigna Healthcare"

**Example Output**: "Hello, Welcome to Cigna Healthcare! How can I assist you today?"

 ----

## Agent 2: Router Agent (NOW GLOBAL)

**New Configuration**:

 - **is_global**: True (can be accessed from any specialized agent)
 - **Prompt**: Uses `{{supported_intents}}` dynamic variable
 - **Global Condition**: Detects when user wants to switch topics

**Dynamic Variable Usage**:

 - `{{supported_intents}}` → ["appointments", "insurance", "payment"]

**Behavior Changes**:

 - Still routes from greeting to specialized agents
 - **NEW**: Can be re-triggered from specialized agents when user changes topic
 - Maintains conversation context across topic switches

**Example Re-routing Scenario**:

```Text
1. User with Insurance Agent: "Actually, can you help me schedule instead?"
2. Global condition detects topic switch
3. Returns to Router Agent
4. Router re-evaluates: "Of course! Let me help you schedule."
5. Routes to Scheduling Agent
```

-----
## Agents 3-5: Insurance, Scheduling, Payment (Unchanged)

Same configuration as Example 2, but now they can trigger global router when user switches topics.

-----

## Agent 6: End Conversation Agent

**Configuration Changes**:

 - **Messages**: Now uses two dynamic variables for variation
    - `{{farewell_phrase_1}}`
    - `{{farewell_phrase_2}}`

**Dynamic Variable Usage**:

```Text
farewell_phrase_1: "Thank you for chatting with CignaCare Assistant. Have a great day!"
farewell_phrase_2: "We appreciate your time. Goodbye!"
```

**Behavior**: Can output different farewell messages for variety

## Conversation Flow Details

All transitions from Example 2, plus:


## NEW: Global Re-routing to Router Agent

**Type**: Global Edge (from specialized agents)

**Configuration**:

 - **Source**: Any of Insurance/Scheduling/Payment agents
 - **Destination**: Router Node
 - **Trigger**: Global condition detects topic switch

**Condition**:

```Text
User clearly indicates they want to switch to a different topic mid-conversation.
Examples:
- "Actually, I have a question about my insurance." [from scheduling]
- "Can you help me with payments instead?" [from insurance]
```

**Behavior**:
 - Evaluated during each specialized agent's turn
 - When triggered, returns control to router
 - Router re-evaluates intent and routes accordingly
 - Enables seamless topic transitions

## Workflow Execution Scenarios

## Scenario 1: Topic Switching (New Capability)

 1. **Start** → Greeting (with custom phrase)
 2. **Router**: "What can I help you with?"
 3. **User**: "I need to book an appointment"
 4. **Router** → Scheduling Agent
 5. **Scheduling**: "Which doctor would you like to see?"
 6. **User**: "Actually, I have a billing question first"
 7. **Global re-routing** triggers → Router Agent
 8. **Router**: "Let me connect you with billing."
 9. **Router** → Payment Agent
 10. **Payment**: Handles billing question
 11. **User**: "Thanks, goodbye"
 12. **Global farewell** → End Conversation (custom message)

## Scenario 2: Dynamic Personalization

**Runtime Variables Set 1** (Clinic A):

```Json
{
  "greeting_phrase": "Welcome to Riverside Medical!",
  "supported_intents": ["appointments", "insurance"],
  "farewell_phrase_1": "Thank you for choosing Riverside Medical!"
}
```

**Runtime Variables Set 2** (Clinic B):

```Json
{
  "greeting_phrase": "Hello from Downtown Health Center!",
  "supported_intents": ["appointments", "insurance", "payment", "prescriptions"],
  "farewell_phrase_1": "Thank you for trusting Downtown Health!"
}
```

Same workflow, different branding and capabilities!

## Key Takeaways

**Dynamic Variables**:

 - Separate workflow logic from content
 - Enable runtime customization and personalization
 - Support multi-tenancy and A/B testing
 - Template syntax `{{variable}}` in prompts

**Global Re-routing**:

 - Users can switch topics mid-conversation
 - Global router accessible from any specialized agent
 - Maintains conversation flow and context
 - Improves user experience with fluid navigation

**Enhanced Flexibility**:

 - Same workflow definition, multiple use cases
 - Branding and messaging configurable at runtime
 - Scalable across different organizations or departments
 
**Comparison to Example 2**:

 - Adds dynamic variable injection
 - Enables mid-conversation topic switching
 - Global router (not just global end conversation)
 - More flexible and reusable workflow design
 - Multiple farewell message variations




















