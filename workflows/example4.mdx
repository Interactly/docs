---
title: Example 4 Structured Data Extraction with Worker Agent
subtitle: Workflows Structured Data Extraction with Worker Agent example
slug: workflows-example-4
mode: wide
---

## High-Level Description

This workflow introduces **Worker LLM agents** - specialized AI agents designed to extract structured data from conversations while simultaneously engaging with users. Unlike conversational agents that generate free-form responses, Worker agents continuously parse conversation history into structured formats (like forms or databases) while asking follow-up questions to complete missing information. This workflow demonstrates a healthcare patient intake process that collects structured information through natural conversation.

## New Concepts Introduced

Building upon Examples 1-3, this workflow adds:

 1. **Worker LLM Agent**:
    - Dual-purpose agent that both converses AND extracts structured data
    - Continuously updates structured output as conversation progresses 
    - Asks intelligent follow-up questions for missing required fields
    - Operates with temperature 0.0 for consistent data extraction
 2. **Structured Output Schema**:
    - JSON Schema definition for data extraction
    - Defines field types: string, integer, boolean, enum
    - Field descriptions guide the AI on what to extract
    - Optional vs. required fields
    - Enum constraints for controlled values
 3. **Natural Language Conditions on Structured Data**:
    - **condition_freeform**: Human-readable conditions referencing structured fields
    - AI interprets when minimum data requirements are met
    - Flexible, intent-based routing based on extracted data
 4. **Summary Agent with User Confirmation**:
    - Agent that processes structured data and provides summary
    - **Wait for User Message**: True (waits for user acknowledgment)
    - Uses dynamic variables for configurable response times

## Workflow Diagram
```Text
┌───────────────────────────────┐
│  Greeting                     │ (START)     
│  Agent                        │
│  Uses: `{{greeting_phrase}}`    |  
│        `{{organization_name}}`  |
└────────┬──────────────────────┘
         │ DirectEdge
         ▼
┌─────────────────────────────────┐
│  Patient Intake Worker Agent    │ ◄─┐
│  (Worker LLM)                   │   │
│                                 │   │ Self-loop
│  Extracts Structured Data:      │   │ (collects info)
│  ┌─────────────────────────┐    │   │
│  │ • full_name             │    │   │
│  │ • age                   │    │   │
│  │ • primary_complaint     │    │   │
│  │ • urgency_level         │    │   │
│  │ • has_insurance         │    │   │
│  │ • preferred_contact     │    │   │
│  └─────────────────────────┘    │ ──┘
└─────────────┬───────────────────┘
              │ ConditionalEdge (freeform)
              │ "when full_name & primary_complaint filled"
              ▼
    ┌───────────────────────────────────┐
    │  Summary                          │
    │  Agent                            │ ◄── Waits for user input
    │  (Say LLM)                        │
    │  Uses: `{{emergency_number}}`       |
    │        `{{urgency_response_times}}` |
    │        `{{closing_message}}`        |
    └────────┬──────────────────────────┘
             │ DirectEdge
             ▼
    ┌─────────────────────────────┐
    │  End                        │
    │  Conversation               │
    │  (Static)                   │
    │  Uses: `{{farewell_message}}` |
    └─────────────────────────────┘
```

## Agent Details

## Agent 1: Greeting Agent

**Purpose**: Welcome the user and explain the intake process.

**Configuration**:

 - **Name**: "Greeting Node"
 - **Is Start**: Yes
 - **Self Loop**: No
 - **Wait for User Message**: No
 - **AI Model**: GPT-4.1-NANO (30 tokens max, temperature 0.5)
 - **Prompt**:
```Text
Welcome the user with a friendly message in less than 15 words. 
Ask them to provide their basic information for a healthcare intake form.
Use the greeting phrase: `{{greeting_phrase}}`
Mention that we are from `{{organization_name}}`.
```

**Dynamic Variables**:
 - greeting_phrase: "Hello and welcome!"
 - organization_name: "HealthFirst Medical Center"

**Example Output**: "Hello and welcome to HealthFirst Medical Center! Please share your basic information for our intake form."

--------

## Agent 2: Patient Intake Worker Agent ⭐ NEW

**Purpose**: Engage in conversation while 
simultaneously extracting structured patient information.

**Configuration**:

 - **Name**: "Patient Intake Worker"
 - **Type**: Worker LLM Agent (new agent type)
 - **Self Loop**: Yes (continues until minimum data collected)
 - **Wait for User Message**: Yes
 - **AI Model**: GPT-4.1 (temperature 0.0 for deterministic extraction)
 - **Prompt**: Empty string (relies on structured schema to guide behavior)
 - **Structured Output Schema**:
```Json
  {
  "name": "PatientIntakeForm",
  "description": "Extract structured patient information based on the chat history so far. 
                  If any information is missing, do not populate that field. 
                  Do not make assumptions. Only fill in what has been explicitly provided by the patient.",
  "input_schema": {
    "title": "PatientIntakeData",
    "type": "object",
    "properties": {
      "full_name": {
        "type": "string",
        "description": "Patient's complete name (first and last)"
      },
      "age": {
        "type": "integer",
        "description": "Patient's age in years"
      },
      "primary_complaint": {
        "type": "string",
        "description": "Main health concern or reason for visit"
      },
      "urgency_level": {
        "type": "string",
        "enum": ["low", "medium", "high", "emergency"],
        "description": "Assessed urgency level based on symptoms"
      },
      "has_insurance": {
        "type": "boolean",
        "description": "Whether the patient has health insurance"
      },
      "preferred_contact": {
        "type": "string",
        "enum": ["phone", "email", "text", "portal"],
        "description": "Patient's preferred method of communication"
        }
      },
      "required": []
     }
   }
```

**How Worker Agents Work**:
 1. **Dual Output**: Generates both conversational response AND structured data
 2. **Continuous Parsing**: After each user message, re-analyzes entire conversation
 3. **Smart Questioning**: Identifies missing fields and asks targeted follow-ups
 4. **Incremental Updates**: Structured output grows as more information is shared
 5. **No Hallucination**: Only populates fields with explicitly stated information 

**Example Interaction Flow**:

```Text
Worker: "I'd be happy to help you today. Can you start by telling me your name and what brings you in?"

User: "I'm John Smith and I've been having back pain for 3 days"

→ Structured Output Updated:
{
  "full_name": "John Smith",
  "primary_complaint": "back pain for 3 days"
}

Worker: "Thank you, John. How old are you, and would you describe the pain as mild, moderate, or severe?"

User: "I'm 45, and it's moderate pain"

→ Structured Output Updated:
{
  "full_name": "John Smith",
  "age": 45,
  "primary_complaint": "back pain for 3 days",
  "urgency_level": "medium"
}

Worker: "Got it. Do you have health insurance, and how would you prefer we contact you?"

User: "Yes, I have insurance. You can call me."

→ Structured Output Updated:
{
  "full_name": "John Smith",
  "age": 45,
  "primary_complaint": "back pain for 3 days",
  "urgency_level": "medium",
  "has_insurance": true,
  "preferred_contact": "phone"
}

→ Condition Met: full_name and primary_complaint both present
→ Transition to Summary Agent
```
**Behavior**:

 - Engages naturally and empathetically with patients
 - Never mentions the underlying data extraction process
 - Asks open-ended questions to gather information efficiently
 - Validates data types (age must be integer, urgency must be from enum)
 - Loops until minimum required information is collected

-----

## Agent 3: Summary Agent

**Purpose**: Provide a comprehensive summary of collected information and outline next steps based on urgency.

**Configuration**:

 - **Name**: "Intake Summary"
 - **Type**: Say LLM Agent
 - **Self Loop**: No
 - **Wait for User Message**: Yes (waits for user acknowledgment)
 - **AI Model**: GPT-4.1 (400 tokens max, temperature 0.0)
 - **Prompt**:

```Text
You are a summarization agent whose specific role is to provide a concise and friendly 
summary of the patient intake information collected.

Based on the patient intake information that was just collected, provide a friendly 
summary of what was captured. Thank the patient and let them know what the next steps 
will be based on their urgency level.

For emergency cases: Direct them to call `{{emergency_number}}` or go to the nearest 
                     emergency room immediately.
For high urgency: Let them know they'll be contacted within `{{high_urgency_response_time}}`.
For medium urgency: Let them know they'll be contacted within `{{medium_urgency_response_time}}`.
For low urgency: Let them know they'll be contacted within `{{low_urgency_response_time}}`.

Keep the response warm, professional, and reassuring.
End with: `{{closing_message}}`
```

**Dynamic Variables**:
 - emergency_number: "911"
 - high_urgency_response_time: "2 hours"
 - medium_urgency_response_time: "24 hours"
 - low_urgency_response_time: "48 hours"
 - closing_message: "Your health is our priority, and we're here to help."

**How It Accesses Structured Data**:

 - Automatically receives the structured output from the Worker agent
 - Can reference all extracted fields in its response
 - Uses urgency_level to determine appropriate next steps

**Example Output**: "Thank you, John! I've recorded that you're 45 years old experiencing moderate back pain for 3 days. Based on the information provided, this is a medium urgency case. We'll have someone contact you within 24 hours via phone to schedule your appointment. Your health is our priority, and we're here to help."

**Behavior**:
 - Confirms all captured information with the patient
 - Provides personalized next steps based on urgency level
 - Waits for user acknowledgment before proceeding
 - Reassures the patient about follow-up timeline

-----

## Agent 4: End Conversation Agent

**Purpose**: Conclude the intake process with a farewell message.

**Configuration**:

 - **Name**: "End Conversation"
 - **Type**: Static Message
 - **Message**: "`{{farewell_message}}`"

**Dynamic Variable**:
 - farewell_message: "Thank you for providing your information. We'll be in touch soon. Have a great day!"

## Conversation Flow Details

## Transition 1: Greeting to Intake Worker

**Type**: Direct Edge

**Configuration**:

 - **Source**: Greeting Node
 - **Destination**: Patient Intake Worker
 - **Name**: "Go to Patient Intake"
 - **Description**: "After greeting, route to the intake worker to collect patient information."

**Behavior**: Automatic, unconditional transition.

--------

## Transition 2: Intake Worker to Summary (Natural Language Condition) ⭐

**Type**: Conditional Edge

**Purpose**: Proceed to summary when minimum required patient information has been collected.

**Configuration**:

 - **Source**: Patient Intake Worker
 - **Destination**: Intake Summary
 - **Name**: "Go to Summary"
 - **Description**: "Routes from intake worker to summary when information is complete."
 - **Condition Type**: condition_freeform (natural language)
 - **Condition**:

```Text
Trigger this to route to the internal summary agent right after you have collected 
sufficient information to fill out the patient intake form.
Specifically, trigger when the fields 'full_name' and 'primary_complaint' have been 
filled in the structured output.
```

**How It Works**:

 - The AI analyzes the natural language condition
 - Checks if the described criteria are met
 - In this case: verifies both full_name and primary_complaint fields have values
 - When condition is satisfied, transition activates

**Benefits of Freeform Conditions**:

 - Flexible, human-readable
 - Can describe complex multi-field requirements
 - AI interprets intent ("sufficient information")
 - Easy to understand and modify

**Limitation**:

 - Less deterministic than expression language
 - Relies on AI interpretation
 - May vary slightly in behavior

----

## Transition 3: Summary to End Conversation

**Type**: Direct Edge

**Configuration**:

 - **Source**: Intake Summary
 - **Destination**: End Conversation
 - **Name**: "End Conversation"
 - **Description**: "After providing summary, end the conversation."

**Behavior**: Automatic transition after summary and user acknowledgment.

## Complete Workflow Execution Example

## Full Patient Intake Scenario:

**Step 1: Greeting**

```Text
[Workflow Starts]
→ Greeting Agent: "Hello and welcome to HealthFirst Medical Center! Please share your basic information for our intake form."
→ [Automatic transition to Patient Intake Worker]
```

**Step 2: Information Collection**

```Text
Worker: "I'd be happy to help. Can you tell me your name and what brings you in today?"

User: "Hi, I'm Sarah Johnson"

→ Structured Data: {"full_name": "Sarah Johnson"}

Worker: "Nice to meet you, Sarah. What brings you in today?"

User: "I've had a persistent headache for 5 days"

→ Structured Data: {
  "full_name": "Sarah Johnson",
  "primary_complaint": "persistent headache for 5 days"
}

→ Condition Check: ✅ Both full_name and primary_complaint present
→ [Automatic transition to Summary Agent]
```

**Step 3: Summary**

```Text
Summary Agent: "Thank you, Sarah! I've noted your concern about a persistent headache for 5 days. Based on the information provided, we'll have someone contact you within 24 hours to discuss next steps. Your health is our priority, and we're here to help."

[Waits for user response]

User: "Thank you!"

→ [Automatic transition to End Conversation]
```

**Step 4: Farewell**

```Text
End Conversation: "Thank you for providing your information. We'll be in touch soon. Have a great day!"

[Workflow Ends]
```

## Key Takeaways

**Worker LLM Agents**:

 - Revolutionary dual-purpose: conversation + data extraction
 - Temperature 0.0 ensures consistent structured output
 - Continuously updates data as conversation progresses
 - Asks intelligent follow-up questions automatically
 - Never exposes data extraction process to user

**Structured Output Schemas**:

 - JSON Schema defines exact data structure
 - Field types enforce data validation
 - Descriptions guide AI extraction
 - Enum constraints limit to valid values
 - Optional fields allow flexible collection

**Natural Language Conditions**:

 - Freeform text describes routing logic
 - AI interprets when conditions are met
 - References structured field names
 - More flexible than hard-coded logic
 - Easy to read and modify

## Dynamic Variables:

 - Customize response times per organization
 - Inject branding and contact information
 - Same workflow, different configurations
 - Runtime flexibility without code changes

**Use Cases**:

 - Patient intake and registration
 - Customer onboarding forms
 - Survey and questionnaire collection
 - KYC (Know Your Customer) processes
 - Lead qualification
 - Application forms
 - Any structured data collection via conversation

**Advantages Over Traditional Forms**:

 - Natural conversation vs. rigid form fields
 - Can gather context and nuance
 - Intelligent follow-up questions
 - Better user experience
 - Still produces structured, database-ready output

**Comparison to Previous Examples**:
 - Examples 1-3: Free-form conversation only
 - Example 4: Conversation + structured data extraction
 - Enables database integration and automated processing
 - Foundation for data-driven workflows





 
 




 


 
 











 
    
 
