---
title: Example 5 Expression Language for Precise Routing
subtitle: Workflows Expression Language for Precise Routing example
slug: workflows-example-5
mode: wide
---

## High-Level Description

This workflow demonstrates **Expression Language** - a powerful, deterministic alternative to natural language conditions. While Example 4 used human-readable freeform conditions, this example shows how to use programmatic expressions for precise, predictable routing based on structured data. The workflow implements the same patient intake process, but uses expression language to make routing decisions based on exactly which fields have been filled and their specific values.

## New Concepts Introduced

Building upon Examples 1-4, this workflow adds:

 1. **Expression Language**(condition_expression):
    - Deterministic, code-like conditions for routing
    - Precise control over when transitions activate
    - References structured output fields directly
    - Supports complex boolean logic (AND, OR, NOT)
 2. **Built-in Functions**:
    - isPresent(field_name): Checks if a field has a value
    - Prevents transitions based on missing data
    - More reliable than AI interpretation
 3. **Boolean Operations**:
    - **AND**: All conditions must be true
    - **OR**: At least one condition must be true
    - Parentheses for grouping logic
    - Combines multiple field checks
 4. **Comparison Operators**:
    - ==: Equality check (e.g., urgency_level == "emergency")
    - Can test enum values
    - Can compare strings, numbers, booleans

## Workflow Diagram

```Text
┌─────────────────────────────┐
│  Greeting                   │ (START)
│  Agent                      │
│  Uses: `{{greeting_phrase}}`  |
│        `{{organization_name}}`|
└────────┬────────────────────┘
         │ DirectEdge
         ▼
┌─────────────────────────────────┐
│  Patient Intake Worker Agent    │ ◄─┐
│  (Worker LLM)                   │   │
│                                 │   │ Self-loop
│  Extracts Structured Data:      │   │ (collects info)
│  ┌─────────────────────────┐    │   │
│  │ • full_name             │    │   │
│  │ • age                   │    │   │
│  │ • primary_complaint     │    │   │
│  │ • urgency_level         │    │   │
│  │ • has_insurance         │    │   │
│  │ • preferred_contact     │    │   │
│  └─────────────────────────┘    │ ──┘
└─────────────┬───────────────────┘
              │ ConditionalEdge (expression) ⭐
              │ isPresent(full_name) AND isPresent(primary_complaint)
              ▼
    ┌──────────────────────────────────┐
    │  Summary                         │
    │  Agent                           │ ◄── Waits for user input
    │  (Say LLM)                       │
    │  Uses: `{{emergency_number}}`      |
    │        `{{urgency_response_times}}`|
    │        `{{closing_message}}`       | 
    └────────┬─────────────────────────┘
             │ DirectEdge
             ▼
    ┌────────────────────────────┐
    │  End                       │
    │  Conversation              │
    │  (Static)                  │
    │  Uses: `{{farewell_message}}`|
    └────────────────────────────┘
```
## Agent Details

## Agent 1: Greeting Agent

**Purpose**: Welcome the user and explain the intake process.

**Configuration**:

 - **Name**: "Greeting Node"
 - **Is Start**: Yes
 - **Self Loop**: No
 - **Wait for User Message**: No
 - **AI Model**: GPT-4.1-NANO (30 tokens max, temperature 0.5)
 - **Prompt**:
```Text
  Welcome the user with a friendly message in less than 15 words. 
Ask them to provide their basic information for a healthcare intake form.
Use the greeting phrase: `{{greeting_phrase}}`
Mention that we are from `{{organization_name}}`.
```
### Dynamic Variables:
 - greeting_phrase: "Hello and welcome!"
 - organization_name: "HealthFirst Medical Center"

----
## Agent 2: Patient Intake Worker Agent

**Purpose**: Engage in conversation while extracting structured patient information.

**Configuration**:

 - **Name**: "Patient Intake Worker"
 - **Type**: Worker LLM Agent
 - **Self Loop**: Yes
 - **Wait for User Message**: Yes
 - **AI Model**: GPT-4.1 (temperature 0.0 for deterministic extraction)
 - **Prompt**: Empty string
 - **Structured Output Schema**:
```Json
  {
  "name": "PatientIntakeForm",
  "description": "Extract structured patient information based on the chat history so far. 
                  If any information is missing, do not populate that field. 
                  Do not make assumptions. Only fill in what has been explicitly provided by the patient.",
  "input_schema": {
    "title": "PatientIntakeData",
    "type": "object",
    "properties": {
      "full_name": {
        "type": "string",
        "description": "Patient's complete name (first and last)"
      },
      "age": {
        "type": "integer",
        "description": "Patient's age in years"
      },
      "primary_complaint": {
        "type": "string",
        "description": "Main health concern or reason for visit"
      },
      "urgency_level": {
        "type": "string",
        "enum": ["low", "medium", "high", "emergency"],
        "description": "Assessed urgency level based on symptoms"
      },
      "has_insurance": {
        "type": "boolean",
        "description": "Whether the patient has health insurance"
      },
      "preferred_contact": {
        "type": "string",
        "enum": ["phone", "email", "text", "portal"],
        "description": "Patient's preferred method of communication"
       }
      },
     "required": []
    }
  }
```
**Behavior**: Same as Example 4 - continues looping until minimum information is collected.

-----

## Agent 3: Summary Agent

**Purpose**: Provide a comprehensive summary of collected information and outline next steps.

**Configuration**:

 - **Name**: "Intake Summary"
 - **Type**: Say LLM Agent
 - **Self Loop**: No
 - **Wait for User Message**: Yes
 - **AI Model**: GPT-4.1 (400 tokens max, temperature 0.0)
 - **Prompt**:
```Text
 You are a summarization agent whose specific role is to provide a concise and friendly 
summary of the patient intake information collected.

Based on the patient intake information that was just collected, provide a friendly 
summary of what was captured. Thank the patient and let them know what the next steps 
will be based on their urgency level.

For emergency cases: Direct them to call `{{emergency_number}}` or go to the nearest 
                     emergency room immediately.
For high urgency: Let them know they'll be contacted within `{{high_urgency_response_time}}`.
For medium urgency: Let them know they'll be contacted within `{{medium_urgency_response_time}}`.
For low urgency: Let them know they'll be contacted within `{{low_urgency_response_time}}`.

Keep the response warm, professional, and reassuring.
End with: `{{closing_message}}`
```

### Dynamic Variables:
 - emergency_number: "911"
 - high_urgency_response_time: "2 hours"
 - medium_urgency_response_time: "24 hours"
 - low_urgency_response_time: "48 hours"
 - closing_message: "Your health is our priority, and we're here to help."

 ----

## Agent 4: End Conversation Agent

**Purpose**: Conclude the intake process with a farewell message.

**Configuration**:

 - **Name**: "End Conversation"
 - **Type**: Static Message
 - **Message**: "`{{farewell_message}}`"

**Dynamic Variable**:
 - farewell_message: "Thank you for providing your information. We'll be in touch soon. Have a great day!"

## Conversation Flow Details

## Transition 1: Greeting to Intake Worker

**Type**: Direct Edge  

**Configuration**:

 - **Source**: Greeting Node
 - **Destination**: Patient Intake Worker
 - **Name**: "Go to Patient Intake"
 - **Description**: "After greeting, route to the intake worker to collect patient information."

**Behavior**: Automatic, unconditional transition.

----

## Transition 2: Intake Worker to Summary (Expression Language) ⭐

**Type**: Conditional Edge

**Purpose**: Proceed to summary when minimum required patient information has been collected.

**Configuration**:

 - **Source**: Patient Intake Worker
 - **Destination**: Intake Summary
 - **Name**: "Go to Summary"
 - **Description**: "Routes from intake worker to summary when information is complete."
 - **Condition Type**: condition_expression (programmatic expression)
 - **Expression**:

```Text
 isPresent(full_name) AND isPresent(primary_complaint)
```

### How Expression Language Works:

 1. **Field References**: Directly reference structured output field names
    - full_name refers to the "full_name" field in PatientIntakeData
    - primary_complaint refers to the "primary_complaint" field
 2. isPresent() **Function**:
    - Returns true if the field has been populated with a value
    - Returns false if the field is null, undefined, or empty string
    - Syntax: isPresent(field_name)
 3. AND **Operator**:
    - Both conditions must be true for the expression to evaluate to true
    - If either field is missing, the expression is false
    - Transition only activates when expression is true
 4. **Execution Flow**:

```Text
After each user message:
1. Worker agent updates structured output
2. Expression is evaluated against current structured data
3. If expression == true → transition activates
4. If expression == false → stay in current agent (self-loop)
```
### Example Evaluation:
```Text
# Initial state (no data collected yet)
Structured Data: {}
Expression: isPresent(full_name) AND isPresent(primary_complaint)
Evaluation: false AND false = false
Result: Stay in Worker agent

# After user provides name
Structured Data: {"full_name": "John Doe"}
Expression: isPresent(full_name) AND isPresent(primary_complaint)
Evaluation: true AND false = false
Result: Stay in Worker agent (still need complaint)

# After user provides complaint
Structured Data: {
  "full_name": "John Doe",
  "primary_complaint": "chest pain"
}
Expression: isPresent(full_name) AND isPresent(primary_complaint)
Evaluation: true AND true = true
Result: ✅ Transition to Summary Agent
```
### Benefits of Expression Language:
 - **Deterministic**: Same input always produces same output
 - **Predictable**: No AI interpretation variability
 - **Precise**: Exact field-level control
 - **Testable**: Can validate logic before deployment
 - **Debuggable**: Clear true/false evaluation
 - **Fast**: No AI inference required for evaluation

**Advanced Expression Examples** (not used in this workflow, but possible):
```Text
// Check if ANY of three fields is present
isPresent(email) OR isPresent(phone) OR isPresent(address)

// Check if age is within range
isPresent(age) AND age >= 18 AND age <= 65

// Check for specific enum value
isPresent(urgency_level) AND urgency_level == "emergency"

// Complex nested logic
(isPresent(full_name) AND isPresent(email)) OR 
(isPresent(phone) AND isPresent(address))

// Check multiple required fields
isPresent(first_name) AND isPresent(last_name) AND 
isPresent(date_of_birth) AND isPresent(primary_complaint)
```

----

## Transition 3: Summary to End Conversation

**Type**: Direct Edge

**Configuration**:

 - **Source**: Intake Summary
 - **Destination**: End Conversation
 - **Name**: "End Conversation"
 - **Description**: "After providing summary, end the conversation."

**Behavior**: Automatic transition after summary and user acknowledgment.

## Expression Language vs. Freeform Conditions

## Comparison Table    

```Table
 Aspect          Freedom(Example 4)             Expression Language (Example 5)
----------------------------------------------------------------------------
 Format          Natural language description   Programmatic code-like syntax
----------------------------------------------------------------------------
 Evaluation      AI interprets intent           Direct evaluation (no AI)
----------------------------------------------------------------------------
 Determinism     May vary slightly              Always deterministic
----------------------------------------------------------------------------
 Speed           Requires AI inference          Instant evaluation
----------------------------------------------------------------------------
 Precision       Intent-based                   Exact field-level control
----------------------------------------------------------------------------
Debugging        Harder to predict              Clear true/false logic
----------------------------------------------------------------------------
Readability      Very human-friendly            Technical but clear
----------------------------------------------------------------------------
Use Case         Complex intent-based routing   Precise data-driven routing

```

## Example 4 Condition (Freeform):

```Text
"Trigger this to route to the internal summary agent right after you have collected 
sufficient information to fill out the patient intake form.
Specifically, trigger when the fields 'full_name' and 'primary_complaint' have been 
filled in the structured output."
```
## Example 5 Condition (Expression):
`
isPresent(full_name) AND isPresent(primary_complaint)
`
### When to Use Each:

### Use Freeform Conditions When:

 - Routing logic is complex and nuanced
 - You want AI to interpret user intent
 - Conditions are hard to express programmatically
 - Flexibility is more important than precision
### Use Expression Language When:
 - You need deterministic, predictable behavior
 - Routing is based on specific field values
 - You want fast, non-AI evaluation
 - Precision and testability are critical
 - You're building production systems requiring reliability

## Complete Workflow Execution Example

## Full Patient Intake Scenario (Same Flow, Different Routing Logic):

### Step 1: Greeting

```Text
[Workflow Starts]
→ Greeting Agent: "Hello and welcome to HealthFirst Medical Center! Please share your basic information for our intake form."
→ [Automatic transition to Patient Intake Worker]
```

### Step 2: Information Collection with Expression Evaluation

```Text
Worker: "I'd be happy to help. Can you tell me your name and what brings you in today?"

User: "My name is Lisa Chen"

→ Structured Data: {"full_name": "Lisa Chen"}
→ Expression Check: isPresent(full_name) AND isPresent(primary_complaint)
→ Evaluation: true AND false = false
→ Result: Stay in Worker agent

Worker: "Nice to meet you, Lisa. What brings you in today?"

User: "I've been experiencing dizziness"

→ Structured Data: {
  "full_name": "Lisa Chen",
  "primary_complaint": "experiencing dizziness"
}
→ Expression Check: isPresent(full_name) AND isPresent(primary_complaint)
→ Evaluation: true AND true = true ✅
→ Result: Transition to Summary Agent
```
### Step 3: Summary

```Text
Summary Agent: "Thank you, Lisa! I've noted your concern about experiencing dizziness. Based on the information provided, we'll have someone contact you within 24 hours to discuss next steps. Your health is our priority, and we're here to help."

[Waits for user response]

User: "Sounds good, thank you"

→ [Automatic transition to End Conversation]
```

### Step 4: Farewell

```Text
End Conversation: "Thank you for providing your information. We'll be in touch soon. Have a great day!"

[Workflow Ends]
```

## Key Takeaways

### Expression Language Fundamentals:

 - Code-like syntax for routing conditions
 - Evaluates directly against structured data
 - No AI inference required for evaluation
 - Instant, deterministic results

### isPresent() Function:

 - Core function for checking field availability
 - Returns boolean (true/false)
 - Essential for preventing premature transitions
 - Syntax: isPresent(field_name)

### Boolean Logic:

 - **AND**: All conditions must be true
 - **OR**: At least one condition must be true
 - **NOT**: Inverts boolean value
 - Parentheses for complex grouping
### Deterministic Routing:

 - Same structured data → same routing decision
 - No variability between runs
 - Predictable, testable, reliable
 - Critical for production systems
### When to Use Expression Language:

 - Production workflows requiring reliability
 - Data-driven decision making
 - Form validation and completeness checks
 - Multi-step processes with clear gates
 - Systems requiring audit trails
 - Applications where precision matters
### Comparison to Example 4:
 - Same workflow structure
 - Same agents and data collection
 - Different conditional evaluation method
 - Example 4: AI interprets natural language condition
 - Example 5: Direct programmatic evaluation
 - Example 5 offers more reliability and speed
### Real-World Applications:
 - **Healthcare**: Minimum required patient data before scheduling
 - **E-commerce**: Complete shipping address before checkout
 - **Finance**: KYC data completeness before account opening
 - **HR**: Application completeness before submission
 - **Customer Service**: Sufficient context before escalation
 - **Surveys**: Required questions before submission
### Advanced Capabilities (foundation for future examples):
 - Combine multiple conditions with AND/OR
 - Check specific enum values
 - Validate numeric ranges
 - Verify data completeness
 - Create complex multi-gate workflows
 - Build decision trees based on data
### Expression Language Syntax Reference:

```Text
// Field presence
isPresent(field_name)

// Boolean operators
condition1 AND condition2
condition1 OR condition2
NOT condition

// Comparison operators
field_name == "value"
age > 18
score <= 100

// Complex combinations
(isPresent(email) OR isPresent(phone)) AND isPresent(consent)
isPresent(urgency) AND urgency == "emergency"
age >= 21 AND has_insurance == true
```

### Migration Path:
 - Start with freeform for rapid prototyping
 - Convert to expressions for production deployment
 - Use expressions for critical routing decisions
 - Keep freeform for nuanced, intent-based routing
 - Combine both in complex workflows as needed






















    


 







 


