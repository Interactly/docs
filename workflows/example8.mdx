---
title: Example 8 Tool uses for Custom Business Logic
subtitle: Workflows Tool uses for Custom Business Logic example
slug: workflows-example-8
mode: wide
---

## High-Level Description

This workflow introduces **Tools** - a powerful feature that allows you to equip LLMs with Tools. For illustration purposes, we leverage **Inline Python tools** - a concept where custom Python functions can be defined directly within your workflow configuration without pre-registration. These tools enable agents to perform calculations, data transformations, and business logic execution on demand. The example demonstrates an insurance calculator assistant that uses multiple inline tools to calculate premiums, deductibles, eligibility, and cost estimates based on user inputs.

## New Concepts Introduced

Building upon Examples 1-7, this workflow adds:
 1. **InlinePythonTool**:
    - Define Python functions directly in workflow configuration
    - No need for separate tool registration or deployment
    - Functions are available immediately to agents 
    - Full Python capabilities for calculations and logic
2. **Tool Argument Schemas (JSON Schema)**:        
    - Define expected parameters with types and descriptions
    - Support for primitives (string, number, boolean)
    - Support for enums (constrained values)
    - Required vs. optional parameters
3. **Tools**:     
    - Collection of tools assigned to an agent
    - Multiple tools per agent
    - Tools are callable by AI via natural language

## Workflow Diagram
```text
  ┌─────────────────┐
│  Greeting       │ (START)
│  Agent          │
└────────┬────────┘
         │ DirectEdge
         ▼
┌─────────────────────────────────────────────────────┐
│  Insurance Calculator Agent                         │
│  (Say LLM with Inline Python Tools)                 │
│                                                      │
│  Available Tools (4):                               │
│  ┌────────────────────────────────────────────────┐ │
│  │ 1. calculate_monthly_premium                   │ │
│  │    Args: age, coverage_amount, plan_type       │ │
│  │    Returns: Monthly premium amount             │ │
│  │                                                 │ │
│  │ 2. get_deductible_info                         │ │
│  │    Args: plan_type                             │ │
│  │    Returns: Deductible, out-of-pocket, copay   │ │
│  │                                                 │ │
│  │ 3. check_coverage_eligibility                  │ │
│  │    Args: age, has_preexisting, coverage_amt    │ │
│  │    Returns: Eligibility status & restrictions  │ │
│  │                                                 │ │
│  │ 4. estimate_annual_costs                       │ │
│  │    Args: monthly_premium, expenses, plan_type  │ │
│  │    Returns: Total annual cost breakdown        │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│                    │
└───────────────────┬──────────────────────────────────┘
                    │ ConditionalEdge (freeform)
                    │ "user wants to end conversation"
                    ▼
            ┌───────────────┐
            │  End          │
            │  Conversation │
            └───────────────┘
```
## Tool Definitions

## Tool 1: calculate_monthly_premium 
**Purpose**: Calculate monthly insurance premium based on age, coverage amount, and plan type.   

**Configuration**:
 - Name: "calculate_monthly_premium"
 - Signature: "Calculate the monthly insurance premium based on the customer's age, coverage amount, and plan type"
 - Arguments Schema:
```Json
{
  "type": "object",
  "properties": {
    "age": {
      "type": "number",
      "description": "Age of the customer in years"
    },
    "coverage_amount": {
      "type": "number",
      "description": "Desired coverage amount in dollars"
    },
    "plan_type": {
      "type": "string",
      "description": "Type of insurance plan: 'basic', 'standard', or 'premium'",
      "enum": ["basic", "standard", "premium"]
    }
  },
  "required": ["age", "coverage_amount", "plan_type"]
}
``` 
### Python Code:
```Json
def calculate_monthly_premium(age: float, coverage_amount: float, plan_type: str) -> float:
    '''Calculate monthly premium with age-based risk factor and plan multiplier'''
    # Base rate per $1000 of coverage
    base_rate = 0.5
    
    # Age-based risk factor
    if age < 30:
        age_factor = 0.8
    elif age < 45:
        age_factor = 1.0
    elif age < 60:
        age_factor = 1.3
    else:
        age_factor = 1.8
    
    # Plan type multiplier
    plan_multipliers = {
        "basic": 1.0,
        "standard": 1.5,
        "premium": 2.2
    }
    plan_factor = plan_multipliers.get(plan_type.lower(), 1.0)
    
    # Calculate monthly premium
    monthly_premium = (coverage_amount / 1000) * base_rate * age_factor * plan_factor
    
    return round(monthly_premium, 2)
```
### Example Usage:
```Text
User: "How much would insurance cost for a 35-year-old wanting $500,000 coverage?"

Agent calls: calculate_monthly_premium(age=35, coverage_amount=500000, plan_type="basic")
Returns: $250.00

Agent calls: calculate_monthly_premium(age=35, coverage_amount=500000, plan_type="standard")
Returns: $375.00

Agent calls: calculate_monthly_premium(age=35, coverage_amount=500000, plan_type="premium")
Returns: $550.00

Agent: "For $500,000 coverage at age 35: Basic plan is $250/month, Standard is $375/month, and Premium is $550/month."
```
----
## Tool 2: get_deductible_info
**Purpose**: Retrieve deductible information for a given plan type.
**Arguments**:
 - plan_type: "basic", "standard", or "premium  

**Returns**:
```Json
{
  "plan_type": "standard",
  "annual_deductible": "$2,500",
  "out_of_pocket_max": "$5,000",
  "copay_percentage": "20%"
}
```
**Plan Details**:
 - **Basic**: $5,000 deductible, $8,000 max, 30% copay
 - **Standard**: $2,500 deductible, $5,000 max, 20% copay
 - **Premium**: $1,000 deductible, $3,000 max, 10% copay
----
## Tool 3: check_coverage_eligibility
**Purpose**: Determine if customer is eligible for coverage and any restrictions.

**Arguments**:
 - age: Customer age
 - has_preexisting_conditions: Boolean
 - requested_coverage: Coverage amount  

**Eligibility Rules**:

 1. **Under 18**: Not eligible (must apply through guardian)
 2. **Over 75**: Eligible but capped at $500,000 coverage
 3. **Pre-existing conditions + High coverage (>$1M)**: Eligible with $1M cap and 6-month waiting period
 4. **Pre-existing conditions + Standard coverage**: Eligible with 6-month waiting period
 5. **Standard**: Fully eligible, up to $5M      coverage

**Example Returns**:
```Json
{
  "eligible": true,
  "reason": "Eligible with waiting period",
  "waiting_period": "6 months",
  "note": "Coverage for pre-existing conditions subject to 6-month waiting period"
}
```
## Tool 4: estimate_annual_costs
**Purpose**: Calculate total annual costs including premiums and out-of-pocket expenses.  

**Arguments**:
 - monthly_premium: Monthly premium amount
 - expected_medical_expenses: Estimated annual medical costs
 - plan_type: Plan type for deductible calculation 

**Calculation Logic**:

 1. Annual premium = monthly premium × 12
 2. If expenses ≤ deductible: out-of-pocket = expenses
 3. If expenses > deductible: out-of-pocket = deductible + (remaining × copay_percentage)
 4. Total = annual premium + out-of-pocket  

**Example Return**:
```Json
  {
  "annual_premium": "$4,500.00",
  "estimated_out_of_pocket": "$3,200.00",
  "total_estimated_annual_cost": "$7,700.00",
  "plan_type": "standard",
  "breakdown": {
    "monthly_premium": "$375.00",
    "deductible": "$2,500",
    "copay_percentage": "20%"
   }
 }
```
## Agent Details

## Agent 1: Greeting Agent
**Purpose**: Welcome users to the insurance calculator.

**Configuration**:
 - **Model**: GPT-4.1-NANO (30 tokens)
 - **Prompt**: "Welcome warmly to the Insurance Calculator Assistant in less than 15 words. Let them know you can help calculate premiums, check eligibility, and estimate costs."

## Agent 2: Insurance Calculator Agent
**Purpose**: Interactive calculator using inline Python tools to answer insurance questions.

**Configuration**:
 - **Name**: "Insurance Calculator"
 - **Type**: Say LLM Agent
 - **Self Loop**: Yes
 - **Wait for User Message**: Yes
 - **Model**: GPT-4.1 (300 tokens, temperature 0.2)

 - **Max Consecutive Tool Calls**: 5 (can call multiple tools for comprehensive answers)  

**Prompt** (Key Sections):
```Text
YOUR CAPABILITIES:
You have access to the following calculation tools:
1. calculate_monthly_premium: Calculate monthly premiums
2. get_deductible_info: Get deductible details
3. check_coverage_eligibility: Verify eligibility
4. estimate_annual_costs: Estimate total costs

PLAN TYPES:
- Basic: Lower premium, higher deductible ($5,000), 30% copay
- Standard: Moderate premium, moderate deductible ($2,500), 20% copay
- Premium: Higher premium, low deductible ($1,000), 10% copay

YOUR ROLE:
1. Listen to user questions
2. Use appropriate tools to perform calculations
3. Present results clearly
4. Offer additional scenarios
5. Keep responses concise (2-3 sentences)

IMPORTANT:
- ALWAYS use tools - never estimate or guess
- Explain calculations in simple terms
- Suggest comparing plans when relevant
- Remind users these are estimates only
```
**Tool Usage Flow**:
 1. User asks question
 2. Agent determines which tool(s) to call
 3. Agent calls tool(s) with appropriate arguments
 4. Tool returns result
 5. Agent presents result in natural language
 6. Agent asks if user wants more information
 ----
## Agent 3: End Conversation Agent
**Purpose**: Conclude the calculator session.
**Type**: Static Message **Message**: "Thank you for using InsureCalc Assistant! For final quotes, please contact a licensed insurance agent. Have a great day!"
## Conversation Flow Details

## Transition 1: Greeting to Calculator

**Type**: Direct Edge **Behavior**: Automatic transition after greeting

----
## Transition 2: Calculator to End Conversation
**Type**: Conditional Edge (Freeform) **Condition**: "User indicates they want to end conversation or says goodbye" **Examples**: "That's all I needed", "Goodbye", "Thanks, I'll contact an agent"
## Complete Workflow Execution Examples

## Example 1: Premium Calculation for Multiple Plans
```Text
[Workflow Starts]

Greeting: "Welcome to InsureCalc Assistant! I can help calculate premiums, check eligibility, and estimate costs."

→ [Transition to Calculator]

Calculator: "I'm here to help with insurance calculations. What would you like to know?"

User: "How much would insurance cost for a 35-year-old wanting $500,000 coverage?"

→ Agent calls calculate_monthly_premium(35, 500000, "basic")
   Returns: 250.0
→ Agent calls calculate_monthly_premium(35, 500000, "standard")
   Returns: 375.0
→ Agent calls calculate_monthly_premium(35, 500000, "premium")
   Returns: 550.0

Calculator: "For $500,000 coverage at age 35: Basic plan is $250/month, Standard is $375/month, and Premium is $550/month. Would you like to see deductible details or annual cost estimates for any of these?"

User: "What's the deductible for the standard plan?"

→ Agent calls get_deductible_info("standard")
   Returns: {
     "plan_type": "standard",
     "annual_deductible": "$2,500",
     "out_of_pocket_max": "$5,000",
     "copay_percentage": "20%"
   }

Calculator: "The Standard plan has a $2,500 annual deductible, $5,000 out-of-pocket maximum, and 20% copay. Would you like me to estimate your total annual costs?"

User: "Yes, if I expect about $3,000 in medical expenses"

→ Agent calls estimate_annual_costs(375, 3000, "standard")
   Returns: {
     "annual_premium": "$4,500.00",
     "estimated_out_of_pocket": "$2,600.00",
     "total_estimated_annual_cost": "$7,100.00"
   }

Calculator: "With the Standard plan and $3,000 in expected medical expenses: Annual premium is $4,500, estimated out-of-pocket is $2,600, for a total of $7,100/year. Would you like to compare with other plans?"

User: "No, that's all. Thank you!"

→ [Transition to End Conversation]

End: "Thank you for using InsureCalc Assistant! For final quotes, please contact a licensed insurance agent. Have a great day!"
```

## Example 2: Eligibility Check with Pre-Existing Conditions
``` Text
Calculator: "What can I help you calculate today?"

User: "Am I eligible for coverage? I'm 45 with a pre-existing condition and want $1.5 million coverage"

→ Agent calls check_coverage_eligibility(45, true, 1500000)
   Returns: {
     "eligible": true,
     "reason": "Eligible with coverage limit",
     "max_coverage": 1000000,
     "waiting_period": "6 months",
     "note": "Coverage for pre-existing conditions subject to 6-month waiting period"
   }

Calculator: "You're eligible! However, with pre-existing conditions, coverage is capped at $1 million and there's a 6-month waiting period. Would you like to see premium estimates for $1 million coverage?"

User: "Yes please"

→ Agent calls calculate_monthly_premium(45, 1000000, "basic")
   Returns: 500.0
→ Agent calls calculate_monthly_premium(45, 1000000, "standard")
   Returns: 750.0
→ Agent calls calculate_monthly_premium(45, 1000000, "premium")
   Returns: 1100.0

Calculator: "For $1 million coverage at age 45: Basic is $500/month, Standard is $750/month, Premium is $1,100/month. These are estimates - contact an agent for final quotes. Anything else I can calculate?"

User: "That's all, thanks!"

→ [End Conversation]
```
## Example 3: Multi-Tool Comprehensive Analysis
```Text
User: "I'm 60 years old, want $750,000 coverage on the premium plan. Can you tell me everything - eligibility, premium, deductible, and annual costs if I expect $5,000 in medical expenses?"

→ Agent calls check_coverage_eligibility(60, false, 750000)
   Returns: {eligible: true, reason: "Fully eligible", max_coverage: 5000000}

→ Agent calls calculate_monthly_premium(60, 750000, "premium")
   Returns: 1485.0

→ Agent calls get_deductible_info("premium")
   Returns: {deductible: "$1,000", out_of_pocket_max: "$3,000", copay: "10%"}

→ Agent calls estimate_annual_costs(1485, 5000, "premium")
   Returns: {
     annual_premium: "$17,820.00",
     out_of_pocket: "$1,400.00",
     total: "$19,220.00"
   }

Calculator: "Great news! You're fully eligible for $750,000 coverage. Here's your complete analysis for the Premium plan:

• Monthly Premium: $1,485
• Annual Premium: $17,820
• Deductible: $1,000 with $3,000 max out-of-pocket and 10% copay
• With $5,000 expected medical expenses, estimated total annual cost: $19,220

Would you like to compare with Standard or Basic plans?"

[User continues or exits]
```
## Key Takeaways
### Inline Python Tools:

 - Define functions directly in workflow config
 - No separate deployment or registration needed
 - Full Python capabilities for business logic
 - Available immediately to agents
### Argument Schemas (JSON Schema):

 - Define parameter types and descriptions
 - Support for primitives, enums, arrays, objects
 - Required vs. optional parameters
 - AI uses schema to call tools correctly
### Tool Execution Flow:

 1. User asks question in natural language
 2. AI determines which tool(s) to call
 3. AI extracts arguments from conversation
 4. Tool executes and returns result
 5. AI presents result naturally
 6. Process repeats as needed

### Benefits of Inline Tools:

 - **Rapid Development**: Define tools where you need them
 - **Accuracy**: Calculations instead of AI estimation
 - **Flexibility**: Full Python for complex logic
 - **Transparency**: Code visible in configuration
 - **Testability**: Functions are standard Python
### Use Cases:

 - **Financial Calculators**: Loans, mortgages, insurance
 - **Health Assessments**: BMI, dosage, risk scores
 - **Business Logic**: Pricing, discounts, eligibility
 - **Data Transformations**: Format conversion, validation
 - **API Wrappers**: Call external services
### Comparison to Previous Examples:

 - Examples 1-7: No custom tools or pre-registered tools
 - Example 8: Inline Python tools for custom calculations
 - Enables AI to perform accurate computations on demand
### Tool Design Best Practices:

 - Clear, descriptive function names
 - Detailed argument descriptions
 - Return structured data (dict/object)
 - Include error handling
 - Keep functions focused (single responsibility)
 - Document expected behavior
### Real-World Applications:

 - Insurance quote calculators
 - Loan payment estimators
 - Health risk assessments
 - Price configurators
 - Eligibility checkers
 - Data validators
 - Format converters
 - API integrations
### Technical Advantages:
 - AI knows exactly when to call tools
 - Type safety via JSON Schema
 - Deterministic results
 - Easy to test and debug
 - Version control friendly
 - No external dependencies

This example demonstrates how inline Python tools transform AI agents from conversational interfaces into powerful calculation and business logic engines while maintaining natural dialogue.



 













  









